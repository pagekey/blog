<!DOCTYPE html><html class="2xl:text-[20px]" dir="ltr" lang="en"><head><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><link href="/sitemap-index.xml" rel="sitemap"><link href="/_astro/favicon.EoKXths8.ico" rel="shortcut icon"><link href="/_astro/favicon.Ca94UIdJ.svg" rel="icon" type="image/svg+xml"><link href="/_astro/favicon.Ca94UIdJ.svg" rel="mask-icon" color="#8D46E7"><link href="/_astro/apple-touch-icon.Ctlcgf5O.png" rel="apple-touch-icon" sizes="180x180"><style>:root{--aw-font-sans:'InterVariable';--aw-font-serif:'InterVariable';--aw-font-heading:'InterVariable';--aw-color-primary:rgb(1 97 239);--aw-color-secondary:rgb(1 84 207);--aw-color-accent:rgb(109 40 217);--aw-color-text-heading:rgb(0 0 0);--aw-color-text-default:rgb(16 16 16);--aw-color-text-muted:rgb(16 16 16 / 66%);--aw-color-bg-page:rgb(255 255 255);--aw-color-bg-page-dark:rgb(3 6 32)}.dark{--aw-color-primary:rgb(1 97 239);--aw-color-secondary:rgb(1 84 207);--aw-color-accent:rgb(109 40 217);--aw-color-text-heading:rgb(247, 248, 248);--aw-color-text-default:rgb(229 236 246);--aw-color-text-muted:rgb(229 236 246 / 66%);--aw-color-bg-page:rgb(3 6 32)}.katex-html{display:none}html{--pagefind-ui-scale:1;--pagefind-ui-primary:rgb(1 97 239);--pagefind-ui-text:rgb(16 16 16);--pagefind-ui-background:rgb(255 255 255);--pagefind-ui-border:rgb(16 16 16 / 66%);--pagefind-ui-tag:rgb(16 16 16 / 66%);--pagefind-ui-border-width:2px;--pagefind-ui-border-radius:8px;--pagefind-ui-image-border-radius:8px;--pagefind-ui-image-box-ratio:3/2;--pagefind-ui-font:sans-serif}html.dark{--pagefind-ui-scale:1;--pagefind-ui-primary:rgb(1 97 239);--pagefind-ui-text:rgb(229 236 246);--pagefind-ui-background:rgb(3 6 32);--pagefind-ui-border:rgb(229 236 246 / 66%);--pagefind-ui-tag:rgb(229 236 246 / 66%);--pagefind-ui-border-width:2px;--pagefind-ui-border-radius:8px;--pagefind-ui-image-border-radius:8px;--pagefind-ui-image-box-ratio:3/2;--pagefind-ui-font:sans-serif}html.dark .pagefind-ui button{color:rgb(229 236 246)}html.dark .pagefind-ui button:hover{color:rgb(229 236 246);border-color:rgb(229 236 246)}</style><script>!function(){const e="system";function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark");const t=document.querySelectorAll("[data-aw-toggle-color-scheme] > input");t&&t.length&&t.forEach((t=>{t.checked="dark"!==e}))}e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light")}()</script><title>OS21: Más PCI + Empezando con Almacenamiento (IDE, SATA) — PageKey</title><meta content="🚀 Let&#39;s take back tech." name="description"/><meta content="index,follow" name="robots"/><link href="https://pagekey.io/blog/2023/pkos-21/es" rel="canonical"/><meta content="OS21: Más PCI + Empezando con Almacenamiento (IDE, SATA)" property="og:title"/><meta content="🚀 Let&#39;s take back tech." property="og:description"/><meta content="https://pagekey.io/blog/2023/pkos-21/es" property="og:url"/><meta content="article" property="og:type"/><meta content="http://i3.ytimg.com/vi/HvZy19u1HDc/hqdefault.jpg" property="og:image"/><meta content="en" property="og:locale"/><meta content="PageKey" property="og:site_name"/><meta content="summary_large_image" name="twitter:card"/><meta content="@onwidget" name="twitter:site"/><meta content="@onwidget" name="twitter:creator"/><meta content="orcPxI47GSa-cRvY11tUe6iGg2IO_RPvnA1q95iEM3M" name="google-site-verification"><link href="/_astro/_page_.Cjeg9Sxf.css" rel="stylesheet"></head><body class="antialiased bg-page text-default tracking-tight"><header class="mx-auto w-full border-b border-gray-50/0 ease-in-out flex-none sticky top-0 transition-[opacity] z-40" data-aw-sticky-header id="header"><div class="absolute inset-0"></div><div class="mx-auto w-full max-w-7xl md:flex md:justify-between md:px-6 px-3 py-3 relative text-default"><div class="flex justify-between"><a href="/" class="flex items-center"><span class="font-bold dark:text-white md:text-xl ml-2 rtl:ml-0 rtl:mr-2 self-center text-2xl text-gray-900 whitespace-nowrap"><span id="pks-daily-emoji">🔑</span> PageKey</span><script>function getDailyEmoji(){var e=Date.now();const n=["📄","🔑","🌩","🗣","🚁","🛎","😳","🐋","📈","🚀","🛰️","📢","🐘","🏆","🔋","🦀","🍍","🍇","💿","⛰","🐧","🎈"];return n[Math.floor(e/864e5)%n.length]}window.addEventListener("DOMContentLoaded",(()=>{document.getElementById("pks-daily-emoji").innerHTML=getDailyEmoji()}))</script></a><div class="flex items-center md:hidden"><button class="flex flex-col cursor-pointer group h-12 items-center justify-center rounded w-12" aria-label="Toggle Menu" data-aw-toggle-menu><span class="sr-only">Toggle Menu</span> <span class="transition duration-200 bg-black dark:bg-white ease h-0.5 my-1 opacity-80 rounded-full transform w-6 group-[.expanded]:rotate-45 group-[.expanded]:translate-y-2.5" aria-hidden="true"></span> <span class="transition duration-200 bg-black dark:bg-white ease h-0.5 my-1 opacity-80 rounded-full transform w-6 group-[.expanded]:opacity-0" aria-hidden="true"></span> <span class="transition duration-200 bg-black dark:bg-white ease h-0.5 my-1 opacity-80 rounded-full transform w-6 group-[.expanded]:-rotate-45 group-[.expanded]:-translate-y-2.5" aria-hidden="true"></span></button></div></div><nav aria-label="Main navigation" class="items-center md:w-auto w-full hidden md:flex md:mx-5 md:overflow-x-auto md:overflow-y-visible overflow-x-hidden overflow-y-auto text-default"><ul class="flex flex-col font-medium md:flex-row md:self-center md:text-[0.9375rem] md:w-auto text-xl tracking-[0.01rem] w-full"><li class=""><a href="/" class="flex px-4 dark:hover:text-white hover:text-link py-3 items-centers">Home</a></li><li class="dropdown"><button class="flex items-center dark:hover:text-white hover:text-link px-4 py-3">Products <svg class="rtl:ml-0 h-3.5 hidden md:inline ml-0.5 rtl:mr-0.5 w-3.5" data-icon="tabler:chevron-down" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:chevron-down"><path d="m6 9l6 6l6-6" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:chevron-down"></use></svg></button><ul class="dark:md:bg-dark drop-shadow-xl dropdown-menu font-medium md:absolute md:backdrop-blur-md md:bg-white/90 md:hidden md:min-w-[200px] md:pl-0 pl-4 rounded"><li><a href="/products/boom" class="dark:hover:text-white hover:text-link block dark:hover:bg-gray-700 first:rounded-t last:rounded-b md:hover:bg-gray-100 px-5 py-2 whitespace-no-wrap">💣 Boom Languages</a></li><li><a href="/products/keydo" class="dark:hover:text-white hover:text-link block dark:hover:bg-gray-700 first:rounded-t last:rounded-b md:hover:bg-gray-100 px-5 py-2 whitespace-no-wrap">✅ KeyDo</a></li><li><a href="/products/keyreader" class="dark:hover:text-white hover:text-link block dark:hover:bg-gray-700 first:rounded-t last:rounded-b md:hover:bg-gray-100 px-5 py-2 whitespace-no-wrap">📙 KeyReader</a></li><li><a href="/products/pkos" class="dark:hover:text-white hover:text-link block dark:hover:bg-gray-700 first:rounded-t last:rounded-b md:hover:bg-gray-100 px-5 py-2 whitespace-no-wrap">💻 PageKey Operating System</a></li><li><a href="/products/pkvid" class="dark:hover:text-white hover:text-link block dark:hover:bg-gray-700 first:rounded-t last:rounded-b md:hover:bg-gray-100 px-5 py-2 whitespace-no-wrap">🎥 PKVid</a></li><li><a href="/products/ptd" class="dark:hover:text-white hover:text-link block dark:hover:bg-gray-700 first:rounded-t last:rounded-b md:hover:bg-gray-100 px-5 py-2 whitespace-no-wrap">🎹 Plaintext DAW</a></li></ul></li><li class=""><a href="/blog" class="flex px-4 dark:hover:text-white hover:text-link py-3 items-centers">Blog</a></li><li class=""><a href="/team" class="flex px-4 dark:hover:text-white hover:text-link py-3 items-centers">Team</a></li></ul></nav><div class="items-center md:w-auto w-full hidden md:flex bottom-0 fixed justify-end left-0 md:mb-0 md:p-0 md:self-center md:static p-3 rtl:left-auto rtl:right-0"><div class="flex items-center justify-between md:w-auto w-full"><div class="flex"><button class="text-muted dark:text-gray-400 dark:focus:ring-gray-700 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex items-center p-2.5 rounded-lg text-sm" aria-label="Toggle between Dark and Light mode" data-aw-toggle-color-scheme type="button"><svg class="w-6 h-6 md:h-5 md:inline-block md:w-5" data-icon="tabler:sun" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:sun"><path d="M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:sun"></use></svg></button> <a href="/search" class="text-muted dark:text-gray-400 dark:focus:ring-gray-700 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex items-center p-2.5 rounded-lg text-sm" aria-label="Search"><svg class="h-5 w-5" data-icon="tabler:search" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:search"><path d="M3 10a7 7 0 1 0 14 0a7 7 0 1 0-14 0m18 11l-6-6" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:search"></use></svg></a></div></div></div></div></header><main><section class="mx-auto lg:py-20 py-8 sm:py-16"><article><header class=""><div class="mb-2 flex flex-col justify-between max-w-3xl mt-0 mx-auto px-4 sm:flex-row sm:items-center sm:px-6"><p><svg class="inline-block -mt-0.5 dark:text-gray-400 h-4 w-4" data-icon="tabler:clock" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:clock"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0-18 0"/><path d="M12 7v5l3 3"/></g></symbol><use xlink:href="#ai:tabler:clock"></use></svg> <time class="inline-block" datetime="Mon Jul 10 2023 00:00:00 GMT+0000 (Coordinated Universal Time)">Jul 10, 2023</time> · <svg class="inline-block -mt-0.5 dark:text-gray-400 h-4 w-4" data-icon="tabler:user" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:user"><path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0-8 0M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:user"></use></svg> <span class="inline-block">Steve Grice</span> · <a href="/category/pagekey-operating-system" class="inline-block capitalize hover:underline">pagekey operating system </a>&nbsp;· <span>12</span> min read</p></div><h1 class="mx-auto sm:px-6 max-w-3xl px-4 font-bold font-heading leading-tighter md:text-5xl text-4xl tracking-tighter">OS21: Más PCI + Empezando con Almacenamiento (IDE, SATA)</h1><p class="text-muted dark:text-slate-400 max-w-3xl mb-8 md:text-2xl mt-4 mx-auto px-4 sm:px-6 text-justify text-xl"></p><img alt="" decoding="async" height="506" loading="eager" src="http://i3.ytimg.com/vi/HvZy19u1HDc/hqdefault.jpg" width="900" class="mx-auto bg-gray-400 dark:bg-slate-700 lg:max-w-[900px] max-w-full mb-6 sm:rounded-md" sizes="(max-width: 900px) 400px, 900px" style="object-fit:cover;object-position:center;max-width:900px;max-height:506px;aspect-ratio:1.7786561264822134;width:100%"></header><div class="mx-auto sm:px-6 max-w-3xl px-6 mt-8 dark:prose-a:text-blue-400 dark:prose-headings:text-slate-300 dark:prose-invert lg:prose-xl prose prose-a:text-primary prose-headings:font-bold prose-headings:font-heading prose-headings:leading-tighter prose-headings:scroll-mt-[80px] prose-headings:tracking-tighter prose-img:rounded-md prose-img:shadow-lg prose-md"><p><a href="./">Also available in English</a></p><p>Todo nuestro mundo funciona con computadoras, pero pocos entienden cómo funcionan las computadoras a nivel más básico. Todo, desde tu teléfono y tu computadora portátil hasta los controladores de vuelo en un avión, contiene al menos un chip llamado CPU, que le indica qué hacer.</p><div class="overflow-hidden text-center w-full"><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen frameborder="0" height="315" referrerpolicy="strict-origin-when-cross-origin" src="https://www.youtube.com/embed/HvZy19u1HDc" style="margin:auto;border-radius:10px" title="YouTube video player" width="560"></iframe></div><p>Se supone que el sistema operativo debe encargarse de todas las operaciones a nivel bajo, incluyendo la interfaz con hardware. Pero ¿cómo se ve esa interfaz en realidad? Es bastante sencillo escribir un archivo utilizando <code>file.write()</code> en Python, pero esto solo es una abstracción de lo que realmente ocurre. En algún lugar, bajo capas y capas de abstracción, hay un disco metálico girando o una unidad de estado sólido, y estás reorganizando ceros y unos en ese disco.</p><p>En esta serie, desechamos todas esas abstracciones cómodas que nos son proporcionadas y realizamos programación a nivel de hardware (bare-metal). Nuestro código ejecuta directamente en el procesador - no hay biblioteca estándar, no hay llamadas al sistema, no existe API aparte del propio procesador. Si te emociona la idea de lograr que las cosas suceden <strong>solamente</strong> con el procesador y nada más, entonces esta serie es para tí.</p><p>PKOS significa PageKey Operating System, que es un sistema operativo construido desde cero, en video, con cada lección aprendida en el camino explicada para que puedas endenderlo fácilmente y aplicar lo que aprendes a tus propios proyectos.</p><p>En esta lección, continuaremos nuesta exploración de PCI, limpiaremos un poco el código, intentaremos (sin éxito) utilizar Rust, y comenzaremos a investigar cómo escribir un controlador de dispositivos de almacenamiento.</p><h2 id="lo-que-hicimos">Lo Que Hicimos</h2><p>Aquí hay un breve resumen de lo que logramos desde el último video. Las adiciones maś importantes se ampliarán en la sección de Inmersiones Profundas a continuación.</p><ul><li>Significativamente refinamos <code>pci.c</code><ul><li>Agregamos <code>struct PCI_Device</code></li></ul></li><li>Mejoras de Código<ul><li>Llamadas “int-to-string” más fáciles</li><li>Envoltura de pantalla</li></ul></li><li>Mision secundaria de Rust: infructuoso</li><li>Investigamos los controladores IDE</li><li>Investigamos los controladores SATA</li><li>Adjuntamos un dispositivo SATA a QEMU</li></ul><h2 id="lecciones-aprendidas">Lecciones Aprendidas</h2><p>Hacer el código para este video produjo un montón de grandes lecciones. Esto es lo que encontré:</p><h3 id="las-estructuras-son-maravillosas">Las estructuras son maravillosas</h3><p>Estaba procrastinando en implementar una estructura para almacenar los datos del dispositivo PCI que estaba tomando de la memoria de configuración, pero me sorprendió lo fácil que fue hacerlo y lo más ordenado que quedó el código cuando lo hice. Solo mira esta encatadora estructura:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#f97583">struct</span><span style="color:#e1e4e8"> PCI_Device {</span></span>
<span class="line"><span style="color:#e1e4e8">    u16 vendor_id;</span></span>
<span class="line"><span style="color:#e1e4e8">    u16 device_id;</span></span>
<span class="line"><span style="color:#e1e4e8">    u8 base_class;</span></span>
<span class="line"><span style="color:#e1e4e8">    u8 sub_class;</span></span>
<span class="line"><span style="color:#e1e4e8">    u8 prog_interface;</span></span>
<span class="line"><span style="color:#e1e4e8">    u16 command;</span></span>
<span class="line"><span style="color:#e1e4e8">    u16 status;</span></span>
<span class="line"><span style="color:#e1e4e8">};</span></span>
<span class="line"></span></code></pre><p>Con esto, logré abstraer todo el bitshifting que se requería para obtener estos datos de la memoria de configuración PCI y simplemente devolver el objeto completo. Esto hizo que la implementación de <code>lspci()</code> sea mucho más limpia y fácil de leer, y evitará la duplicación de código cuándo escribamos el controlador del dispositivo de almacenamiento.</p><h3 id="clase-y-subclase-pci-identificar-la-función-del-dispositivo">Clase y subclase PCI: Identificar la función del dispositivo</h3><p>Cada dispositivo PCI tiene una identificación de proveedor y de dispositivo, y se puede usar estes dos números para buscar exactamente qué dispositivo es - simplemente escríbelo en <a href="https://pcilookup.com">www.pcilookup.com</a> ¡y ve lo que sucede!</p><h3 id="la-compatibilidad-con-rust-de-bare-metal-i686-es-dudosa">La compatibilidad con Rust de bare-metal i686 es dudosa</h3><p>Me entristeció descubrir que x86 de 32 bits, también conocido como i386 o i686, no tiene buen soporte en Rust para la programación de nivel hardware. No existe una cadena de herramientas <code>i686-unknown-none</code> predeterminada, lo que significa que debes definir la tuya basada en <code>i686-unknown-linux-gnu</code>. Hice lo mejor que pude, pero no pude compilar un kernel de multiboot.</p><p>Me encantaría utilizar Rust si lo pudiera entenderlo, pero no estaba destinado para este episodio - por ahora nos ceñiremos a la simplicidad de C.</p><h3 id="los-controladores-de-almacenamiento-ide-pata-y-ahci-sata-son-muy-diferentes">Los controladores de almacenamiento: IDE (PATA) y AHCI (SATA) son muy diferentes</h3><p>Pasé bastante tiempo tratando de hacer funcionar el controlador IDE que se adjuntó por defecto a QEMU. No estoy seguro si era lo que necesitaba - parecía ser una unidad de CD-ROM.</p><p>Según lo que pude recopilar, IDE/PATA ya no se utiliza para unidades de disco duro, pero aún puede utilizarse para CDs. Por otro lado, SATA/AHCI siguen siendo muy relevantes. Consulte las inmersiones profundas a continuación para más información sobre estas tecnologías.</p><h2 id="inmerciones-profundas">Inmerciones profundas</h2><p>Vamos a sumergirnos en los detalles del código para este episodio.</p><h3 id="analizando-los-campos-pci-en-una-estructura">Analizando los campos PCI en una estructura</h3><p>El diseño de la memoria de configuración PCI fue esencial para averiguar cómo analizar los campos:</p><p><img alt="La memoria de configuración PCI" decoding="async" height="945" loading="lazy" src="/_astro/PCI_Configuration_Space.CI6-n0GJ_ICsla.webp" width="1024"></p><p>Recuerda que tenemos a nuestra disposición una función operativa <code>read_pci_port</code>, y toma cuatro argumentos de un byte: <code>bus</code>, <code>slot</code>, <code>function</code>, y <code>offset</code>. Para cualquier dispositivo PCI, se puede hacer múltiples llamadas a esta función, cambiando el valor de <code>offset</code> para capturar las variables que queremos fuera de la estructura que se ve en la foto. Por ejemplo, aquí hay un fragmento de código que ilustra cómo obtenemos las identificaciones de proveedor y dispositivo:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#f97583">struct</span><span style="color:#e1e4e8"> PCI_Device device;</span></span>
<span class="line"><span style="color:#e1e4e8">u32 pci_data </span><span style="color:#f97583">=</span><span style="color:#b392f0"> read_pci_port</span><span style="color:#e1e4e8">(bus, slot, function, </span><span style="color:#79b8ff">0</span><span style="color:#e1e4e8">);</span></span>
<span class="line"><span style="color:#e1e4e8">device.vendor_id </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> pci_data </span><span style="color:#f97583">&amp;</span><span style="color:#f97583"> 0x</span><span style="color:#79b8ff">ffff</span><span style="color:#e1e4e8">;</span></span>
<span class="line"><span style="color:#e1e4e8">device.device_id </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> (pci_data </span><span style="color:#f97583">&gt;&gt;</span><span style="color:#79b8ff"> 16</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">&amp;</span><span style="color:#f97583"> 0x</span><span style="color:#79b8ff">ffff</span><span style="color:#e1e4e8">;</span></span>
<span class="line"></span></code></pre><p>Como puedes ver, leemos 32 bits en el desplazamiento 0, luego hacemos operaciones de bitshift/AND para aislar los campos que necesitamos.</p><p>Mira este primer vistazo al método <code>lspci</code>:</p><p><img alt="Primer vistazo de LSPCI" decoding="async" height="1974" loading="lazy" src="/_astro/lspci_output_early.Bt59UzoM_ZXncnh.webp" width="2704"></p><p>¡Se ve genial! El único problema es que hay bastantes dispositivos con ID de proveedor “pppp”. Eso no puede ser correcto - entonces ¿qué está pasando aquí? Bueno…</p><h3 id="ignorando-dispositivos-pci-inexistentes">Ignorando dispositivos PCI inexistentes</h3><p>El kernel de Linux encuentra dispositivos por verificar si el campo PCI de clase está configurado en <code>0xFFFFFFFF</code> <sup><a href="#user-content-fn-1" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-1">1</a></sup>. OSDev menciona que tambien se puede comprobar si la identificaión de proveedor está configurado en <code>0xFFFF</code> <sup><a href="#user-content-fn-2" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-2">2</a></sup>. Aunque ambas técnicas probablamente funcionen, opté por la última técnica. Aplicar este conocimiento le ahorrará trabajo a nuestra función <code>lspci()</code> al omitir procesamiento adicional cuando detecte un dispositivo inexistente:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#f97583">struct</span><span style="color:#e1e4e8"> PCI_Device device </span><span style="color:#f97583">=</span><span style="color:#b392f0"> get_pci_device</span><span style="color:#e1e4e8">(i, j, k);</span></span>
<span class="line"><span style="color:#f97583">if</span><span style="color:#e1e4e8"> (device.vendor_id </span><span style="color:#f97583">==</span><span style="color:#f97583"> 0x</span><span style="color:#79b8ff">FFFF</span><span style="color:#e1e4e8">) {</span></span>
<span class="line"><span style="color:#f97583">	continue</span><span style="color:#e1e4e8">;</span></span>
<span class="line"><span style="color:#e1e4e8">}</span></span>
<span class="line"></span></code></pre><p>¡Ahora solo vemos dispositivos con valores válidas para el campo de ID de proveedor!</p><p><img alt="LSPCI Output" decoding="async" height="453" loading="lazy" src="/_astro/lspci_output.BAXnuR8f_F490o.webp" width="715"></p><h3 id="buscando-dispositivos-pci">Buscando dispositivos PCI</h3><p>Al observar la captura de pantalla anterior, ¿cuánto puedes deducir acerca de los dispositivos enumerados? Al principio, no tenía idea de por dónde empezar en descifrar estos campos. Sin embargo, una búsqueda rápida me mostró que puedo utilizar <a href="https://www.pcilookup.com">pcilookup.com</a> para averiguar qué son cada uno de estos dispositivos. Por ejemplo, al buscar la ID de proveedor 8086 y el dispositivo 7010, obtengo lo siguente:</p><p><img alt="PCI Lookup" decoding="async" height="92" loading="lazy" src="/_astro/pcilookup.x5-tZ3sg_1DlmfF.webp" width="1707"></p><p>Esto coincide con la documentación de QEMU, y con la salida de <code>info qtree</code>, por lo que parece que nuestro método <code>lspci()</code> es preciso.</p><h3 id="los-campos-de-clase-base-subclase-e-interfaz-de-programación">Los campos de clase base, subclase, e interfaz de programación</h3><p>La lista de campos PCI anterior muestra un gran bloque de 3 bytes para “Código de Clase,” pero en la documentación a veces se refiere al campo “subclase,” el cual no parecía encontrarse en ningún parte. Sin embargo, parecía ser una forma poderosa de saber con qué tipo de dispositivo se está tratando - por ejemplo, la clase 1 indica un dispositivo de almacenamiento masivo y la clase 1 subclase 1 indica una interfaz IDE <sup><a href="#user-content-fn-3" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-3">3</a></sup>.</p><p>Las especificaciones para PCI no parecen ser públicas - tienes que iniciar sesión en el sitio web de PCI-SIG para descargarlas. Sin embargo, alguien ha alojado el documento “PCI Local Bus Specification” de 2004 en su sitio web <sup><a href="#user-content-fn-4" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-4">4</a></sup>, por lo que pude verlo. En la página 217, vemos:</p><blockquote><p>The Class Code register is read-only and is used to identify the generic function of the device and, in some cases, a specific registerlevel programming interface. The register is broken into three bytesize fields. The upper byte (at offset 0Bh) is a base class code which broadly classifies the type of function the device performs. The middle byte (at offset 0Ah) is a sub-class code which identifies more specifically the function of the device. The lower byte (at offset 09h) identifies a specific register-level programming interface (if any) so that device independent software can interact with the device. Encodings for base class, sub-class, and programming interface are provided in Appendix D. All unspecified encodings are reserved.</p></blockquote><p>Pues, eso significa que los tres bytes asignados para “Código de Clase” son de un byte, representando la clase base en la posición <code>0x0b</code>, subclase en <code>0x0a</code>, y interfaz de programación en <code>0x09</code>. ¡Sencillo! Podemos analizar esos campos con este fragmento de código:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#e1e4e8">pci_data </span><span style="color:#f97583">=</span><span style="color:#b392f0"> read_pci_port</span><span style="color:#e1e4e8">(bus, slot, function, </span><span style="color:#f97583">0x</span><span style="color:#79b8ff">09</span><span style="color:#e1e4e8">);</span></span>
<span class="line"><span style="color:#e1e4e8">device.base_class </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> (pci_data </span><span style="color:#f97583">&gt;&gt;</span><span style="color:#79b8ff"> 16</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">&amp;</span><span style="color:#f97583"> 0x</span><span style="color:#79b8ff">ff</span><span style="color:#e1e4e8">;</span></span>
<span class="line"><span style="color:#e1e4e8">device.sub_class </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> (pci_data </span><span style="color:#f97583">&gt;&gt;</span><span style="color:#79b8ff"> 8</span><span style="color:#e1e4e8">) </span><span style="color:#f97583">&amp;</span><span style="color:#f97583"> 0x</span><span style="color:#79b8ff">ff</span><span style="color:#e1e4e8">;</span></span>
<span class="line"><span style="color:#e1e4e8">device.prog_interface </span><span style="color:#f97583">=</span><span style="color:#e1e4e8"> pci_data </span><span style="color:#f97583">&amp;</span><span style="color:#f97583"> 0x</span><span style="color:#79b8ff">ff</span><span style="color:#e1e4e8">;</span></span>
<span class="line"></span></code></pre><p>Hice un poco de trampa por leer con un desplazamiento de <code>0x09</code> para ahorrar un poco de bitshifting. No estoy seguro si hay algún impacto en el rendimiento por no leer en límites de 4 bytes. Probablamente lo haya, pero para nuestros propósitos, ¿realmente importa? Creo que no.</p><h3 id="intentos-de-usar-rust">Intentos de usar Rust</h3><p>Intenté crear un kernel i386 multiboot utilizando Rust. Si hubiera tenido éxito, podría haber enlazado todo el código existente de C y ensamblador en ese ejecutable, ¡y cualquier nuevo desarrollo podría haber sido en Rust! Desunafortunadamente, encontré algunos obstáculos en el camino.</p><p>Una repuesta de StackOverflow por phip1611 <sup><a href="#user-content-fn-5" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-5">5</a></sup> me informó que aunque no hay un objetivo integrado para el código x86 de 32 bit sin sistema operativo, se puede definir un objetivo personalizado colocando un archivo JSON en la raíz del proyecto y señalandolo en <code>.cargo/config.toml</code>. El uso de las macros <code>#![no_std]</code> y <code>#![no_main]</code> desactiva la biblioteca estándar y el método principal, lo que permite la ejecución en bare-metal.</p><p>También encontré un tutorial increíble llamado “Writing an OS in Rust” <sup><a href="#user-content-fn-6" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-6">6</a></sup> que explicaba cada pieza del rompecabezas de manera muy clara. Sin embargo, todo el tutorial fue escrito para x86_64. Quizás se acerca el momento de actualizar PKOS, pero todavía no estoy listo para abandonar los 32 bits.</p><p>Después de lidiar con <code>xargo</code> durante un buen tiempo para la compilación cruzada, finalmente decidí abandonar este enfoque, al menos por ahora.</p><h3 id="qúe-es-ide">¿Qúe es IDE?</h3><p>IDE (Integrated Drive Electronics) significa Electrónica de Unidad Integrada. Es un estándar eléctrico lanzado en 1990 para dispositivos de almacenamiento. Originalmente se conocía como Advanced Technology Attachment (ATA), pero después de la introducción de Serial ATA (SATA), fue renombrado como Parallel ATA (PATA) <sup><a href="#user-content-fn-7" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-7">7</a></sup>.</p><p>Se puede identificar dispositivos IDE usando el campo Código de Clase en la memoria de configuración PCI. OSDev wiki <sup><a href="#user-content-fn-8" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-8">8</a></sup> nos dice:</p><blockquote><p>If the class code is 0x01 (Mass Storage Controller) and the subclass code is 0x01 (IDE), the device is an IDE controller.</p></blockquote><p>Esto se encarga de los dos primeros campos, pero ¿qué hay de ese molesto byte de la Interfaz de Programación? Encontré información que indica que se utiliza para indicar si los dispositivos de almacenamiento primario y secundario son programables, así como su modo de funcionamiento <sup><a href="#user-content-fn-9" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-9">9</a></sup>.</p><p><img alt="IDE Class Code" decoding="async" height="263" loading="lazy" src="/_astro/ide_class_code.DF5iYs00_Z1W0sIP.webp" width="493"></p><figcaption>Créditos de la foto: [9]</figcaption><p></p><p>Encontré la especificación para una tarjeta PCI IDE en línea, y me alegraba mucho ver que los códigos de clase eran exactamente como ya vimos en nuestras investigaciones:</p><p><img alt="Example PCI Card Spec Snippet" decoding="async" height="97" loading="lazy" src="/_astro/example_pci_card_spec_snippet.CgW7V0n7_ZyLxyA.webp" width="643"></p><figcaption>Créditos de la foto: [11]</figcaption><p></p><p>Otro recurso potencialmente útil fue una guía para escribir un controlador de IDE de la documentación del sistema operativo en tiempo real RTEMS <sup><a href="#user-content-fn-12" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-12">10</a></sup>. También pude encontrar el código fuente en GitHub <sup><a href="#user-content-fn-13" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-13">11</a></sup>. Parece que el controlador ATA en <code>ata.c</code> utiliza las functiones (quizás) de nivel inferior en <code>ide_controller.c</code>, pero no estoy completamente seguro.</p><p>RTEMS proporciona una guía distinta para escribir un controlador de ATA <sup><a href="#user-content-fn-16" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-16">12</a></sup>. OSDev también tiene una guía <sup><a href="#user-content-fn-17" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-17">13</a></sup>. Esto me confunde un poco, porque el artículo de TechTarget <sup><a href="#user-content-fn-7" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-7-2">7</a></sup> parece indicar que ATA e IDE son básicalmente intercambiables.</p><h3 id="qué-es-sata">¿Qué es SATA?</h3><p>SATA significa Serial Advanced Technology Attachment, definido, como se indicó anteriormente, en contraste con IDE/PATA. AHCI (Advanced Host Controller Interface) significa Interfaz de Controlador de Host Avanzada. He visto estos dos acrónimos utilizados indistintamente en algunos de los controladores que vi en línea. Sin embargo, Dell indica que puede ser más complicado admitir un dispositivo AHCI que un dispositivo SATA <sup><a href="#user-content-fn-11" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-11">14</a></sup>.</p><p><img alt="PATA vs SATA" decoding="async" height="346" loading="lazy" src="/_astro/pata_vs_sata.DZJZTq1k_Z1hgFAU.webp" width="449"></p><figcaption>Créditos de la foto: TechTarget [7]</figcaption><p></p><h3 id="agregando-sata-a-qemu">Agregando SATA a QEMU</h3><p>Una repuesta de StackOverflow por mwfearnley <sup><a href="#user-content-fn-14" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-14">15</a></sup> explica cómo agregar explicitamente un dispositivo SATA a QEMU:</p><pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8;overflow-x:auto" tabindex="0"><code><span class="line"><span>-drive id=disk,file=IMAGE.img,if=none \</span></span>
<span class="line"><span>-device ahci,id=ahci \</span></span>
<span class="line"><span>-device ide-hd,drive=disk,bus=ahci.0</span></span>
<span class="line"><span></span></span></code></pre><p>Agregué estas lineas a los métodos <code>run</code> y <code>run_debug</code> del guión <code>os.py</code> y, como ya puedes ver, ¡la unidad SATA apareció en <code>lspci</code>! Se encuentra en el Bus 0, Dispositivo 4, Función 0 en la imagen a continuación:</p><p><img alt="LSPCI Output" decoding="async" height="453" loading="lazy" src="/_astro/lspci_output.BAXnuR8f_F490o.webp" width="715"></p><p>Ruben Schade destacó una técnica similar para agregar la unidad en su blog <sup><a href="#user-content-fn-15" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-15">16</a></sup>. También parece que sería bastante agregar <code>-hda IMAGE.img</code> al comando de QEMU, pero lo hice de la manera complicada al principio y funcionó bien, y por eso me quedé con eso.</p><h2 id="conclusión">Conclusión</h2><p>Aunque no logré tanto como quería en este episodio, todavía hice progreso y aprendí mucho. ¡Espero que tú también disfrutaste y aprendiste!</p><p>Los próximos pasos para este proyecto probablamente implicarán crear algún tipo de controlador SATA, pero por lo que he visto hasta ahora, me intimida un poco lo complejo que puede ser. ¡Veremos cómo van las cosas!</p><p>Si disfrutaste esta publicación, considera suscribirte al <a href="https://youtube.com/@PageKey-es">canal de YouTube de PageKey Español</a></p><p>Fuente adicional: <sup><a href="#user-content-fn-10" aria-describedby="footnote-label" data-footnote-ref="" id="user-content-fnref-10">17</a></sup></p><h2 id="referencias">Referencias</h2><section class="footnotes" data-footnotes=""><h2 id="footnote-label" class="sr-only">Footnotes</h2><ol><li id="user-content-fn-1"><p>Método del Linux kernel “early_dump_pci_devices” comprobando si el dispositivo existe usando el campo de clase. <a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/pci/early.c?id=refs/tags/v3.12.7#n96">https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/pci/early.c?id=refs/tags/v3.12.7#n96</a> <a href="#user-content-fnref-1" class="data-footnote-backref" aria-label="Back to reference 1" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-2"><p>OSDev página de PCI. <a href="https://wiki.osdev.org/PCI">https://wiki.osdev.org/PCI</a> <a href="#user-content-fnref-2" class="data-footnote-backref" aria-label="Back to reference 2" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-3"><p>Sitio que muestra los campos de PCI de clase y subclase. <a href="https://pci-ids.ucw.cz/read/PD/">https://pci-ids.ucw.cz/read/PD/</a> <a href="#user-content-fnref-3" class="data-footnote-backref" aria-label="Back to reference 3" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-4"><p>PCI Local Bus Specification de 2004. <a href="https://lekensteyn.nl/files/docs/PCI_SPEV_V3_0.pdf">https://lekensteyn.nl/files/docs/PCI_SPEV_V3_0.pdf</a> <a href="#user-content-fnref-4" class="data-footnote-backref" aria-label="Back to reference 4" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-5"><p>Objetivo x86 de bare-metal x86 en Rust, gracias a phip1611. <a href="https://stackoverflow.com/questions/67902309/how-to-compile-rust-code-to-bare-metal-32-bit-x86-i686-code-what-compile-targ">https://stackoverflow.com/questions/67902309/how-to-compile-rust-code-to-bare-metal-32-bit-x86-i686-code-what-compile-targ</a> <a href="#user-content-fnref-5" class="data-footnote-backref" aria-label="Back to reference 5" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-6"><p>Writing an OS in Rust: <a href="https://os.phil-opp.com/freestanding-rust-binary/">https://os.phil-opp.com/freestanding-rust-binary/</a> <a href="#user-content-fnref-6" class="data-footnote-backref" aria-label="Back to reference 6" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-7"><p>TechTarget descripción de alto nivel de las interfaces PATA y SATA. <a href="https://www.techtarget.com/searchstorage/definition/IDE">https://www.techtarget.com/searchstorage/definition/IDE</a> <a href="#user-content-fnref-7" class="data-footnote-backref" aria-label="Back to reference 7" data-footnote-backref="">↩</a> <a href="#user-content-fnref-7-2" class="data-footnote-backref" aria-label="Back to reference 7-2" data-footnote-backref="">↩<sup>2</sup></a></p></li><li id="user-content-fn-8"><p>Artículo de OSDev PCI IDE Controller. <a href="https://wiki.osdev.org/PCI_IDE_Controller">https://wiki.osdev.org/PCI_IDE_Controller</a> <a href="#user-content-fnref-8" class="data-footnote-backref" aria-label="Back to reference 8" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-9"><p>Especificación del Controlador PCI IDE. <a href="http://www.isdaman.com/alsos/hardware/hdc/pciide.pdf">http://www.isdaman.com/alsos/hardware/hdc/pciide.pdf</a> <a href="#user-content-fnref-9" class="data-footnote-backref" aria-label="Back to reference 9" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-12"><p>Guía de RTEMS para controladores de PCI IDE. <a href="https://docs.rtems.org/branches/master/bsp-howto/ide_controller.html">https://docs.rtems.org/branches/master/bsp-howto/ide_controller.html</a> <a href="#user-content-fnref-12" class="data-footnote-backref" aria-label="Back to reference 10" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-13"><p>Implementación de referencia del controlador PCI IDE de RTEMS. <a href="https://github.com/RTEMS/rtems/tree/master/bsps/shared/dev/ide">https://github.com/RTEMS/rtems/tree/master/bsps/shared/dev/ide</a> <a href="#user-content-fnref-13" class="data-footnote-backref" aria-label="Back to reference 11" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-16"><p>RTEMS ATA driver guide. <a href="https://docs.rtems.org/branches/master/bsp-howto/ata.html">https://docs.rtems.org/branches/master/bsp-howto/ata.html</a> <a href="#user-content-fnref-16" class="data-footnote-backref" aria-label="Back to reference 12" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-17"><p>OSDev ATA driver. <a href="https://github.com/levex/osdev/blob/master/drivers/ata.c">https://github.com/levex/osdev/blob/master/drivers/ata.c</a> <a href="#user-content-fnref-17" class="data-footnote-backref" aria-label="Back to reference 13" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-11"><p>Artículo de Dell sobre SATA vs AHCI. <a href="https://www.dell.com/support/kbdoc/en-us/000127508/difference-between-ahci-and-sata">https://www.dell.com/support/kbdoc/en-us/000127508/difference-between-ahci-and-sata</a> <a href="#user-content-fnref-11" class="data-footnote-backref" aria-label="Back to reference 14" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-14"><p>StackOverflow sobre cómo agregar una unidad SATA a QEMU. <a href="https://stackoverflow.com/questions/48351096/how-to-emulate-a-sata-disk-drive-in-qemu">https://stackoverflow.com/questions/48351096/how-to-emulate-a-sata-disk-drive-in-qemu</a> <a href="#user-content-fnref-14" class="data-footnote-backref" aria-label="Back to reference 15" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-15"><p>Ruben Schade sobre agregar una unidad SATA a QEMU. <a href="https://rubenerd.com/sata-on-qemu/">https://rubenerd.com/sata-on-qemu/</a> <a href="#user-content-fnref-15" class="data-footnote-backref" aria-label="Back to reference 16" data-footnote-backref="">↩</a></p></li><li id="user-content-fn-10"><p>Ejemplo de especificación del proveedor de una tarjeta controladora PCI IDE. <a href="https://pdf.dzsc.com/PC8/PC87410.pdf">https://pdf.dzsc.com/PC8/PC87410.pdf</a> <a href="#user-content-fnref-10" class="data-footnote-backref" aria-label="Back to reference 17" data-footnote-backref="">↩</a></p></li></ol></section></div><div class="flex flex-col justify-between max-w-3xl mx-auto sm:flex-row sm:px-6 mt-8 px-6"><ul class="mr-5 rtl:ml-5 rtl:mr-0"><li class="mb-2 font-medium bg-gray-100 dark:bg-slate-700 inline-block lowercase mr-2 px-2 py-0.5 rtl:ml-2 rtl:mr-0"><a href="/tag/c" class="text-muted hover:text-primary dark:hover:text-gray-200 dark:text-slate-300">c</a></li><li class="mb-2 font-medium bg-gray-100 dark:bg-slate-700 inline-block lowercase mr-2 px-2 py-0.5 rtl:ml-2 rtl:mr-0"><a href="/tag/spanish" class="text-muted hover:text-primary dark:hover:text-gray-200 dark:text-slate-300">spanish</a></li></ul><div class="align-middle dark:text-slate-600 mt-5 sm:mt-1 text-gray-500"><span class="font-bold align-super dark:text-slate-400 text-gray-400">Share:</span> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="twitter" data-aw-url="https://pagekey.io/blog/2023/pkos-21/es" title="Twitter Share" data-aw-text="OS21: Más PCI + Empezando con Almacenamiento (IDE, SATA)"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-x" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-x"><path d="m4 4l11.733 16H20L8.267 4zm0 16l6.768-6.768m2.46-2.46L20 4" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-x"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="facebook" data-aw-url="https://pagekey.io/blog/2023/pkos-21/es" title="Facebook Share"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-facebook" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-facebook"><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 0 1 1-1h3V3h-3a5 5 0 0 0-5 5v2z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-facebook"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="linkedin" data-aw-url="https://pagekey.io/blog/2023/pkos-21/es" title="Linkedin Share" data-aw-text="OS21: Más PCI + Empezando con Almacenamiento (IDE, SATA)"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-linkedin" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-linkedin"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm4 5v5m0-8v.01M12 16v-5"/><path d="M16 16v-3a2 2 0 0 0-4 0"/></g></symbol><use xlink:href="#ai:tabler:brand-linkedin"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="whatsapp" data-aw-url="https://pagekey.io/blog/2023/pkos-21/es" title="Whatsapp Share" data-aw-text="OS21: Más PCI + Empezando con Almacenamiento (IDE, SATA)"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:brand-whatsapp" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-whatsapp"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="m3 21l1.65-3.8a9 9 0 1 1 3.4 2.9z"/><path d="M9 10a.5.5 0 0 0 1 0V9a.5.5 0 0 0-1 0za5 5 0 0 0 5 5h1a.5.5 0 0 0 0-1h-1a.5.5 0 0 0 0 1"/></g></symbol><use xlink:href="#ai:tabler:brand-whatsapp"></use></svg></button> <button class="rtl:ml-0 ml-2 rtl:mr-2" data-aw-social-share="mail" data-aw-url="https://pagekey.io/blog/2023/pkos-21/es" title="Email Share" data-aw-text="OS21: Más PCI + Empezando con Almacenamiento (IDE, SATA)"><svg class="w-6 h-6 dark:hover:text-slate-300 dark:text-slate-500 hover:text-black text-gray-400" data-icon="tabler:mail" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:mail"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="m3 7l9 6l9-6"/></g></symbol><use xlink:href="#ai:tabler:mail"></use></svg></button></div></div></article></section><div class="mx-auto sm:px-6 max-w-3xl px-6 md:pb-20 md:pt-4 pb-12 pt-8"><a href="/blog" class="btn btn-tertiary md:px-3 px-3"><svg class="h-5 w-5 -ml-1.5 mr-1 rtl:-mr-1.5 rtl:ml-1" data-icon="tabler:chevron-left" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:chevron-left"><path d="m15 6l-6 6l6 6" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:chevron-left"></use></svg> Back to Blog</a></div><section class="relative not-prose scroll-mt-[72px]"><div class="absolute inset-0 pointer-events-none -z-[1]" aria-hidden="true"><div class="absolute inset-0"></div></div><div class="mx-auto px-4 max-w-7xl relative lg:pt-0 lg:py-20 md:pt-0 md:px-6 md:py-16 pt-0 py-12 text-default"><div class="flex flex-col lg:flex-row lg:justify-between mb-8"><div class="md:max-w-sm"><h2 class="mb-2 font-bold font-heading group sm:leading-none sm:text-4xl text-3xl tracking-tight">Related Posts</h2><a href="/blog" class="text-muted transition block dark:text-slate-400 duration-200 ease-in hover:text-primary lg:mb-0 mb-6">View All Posts »</a></div></div><div class="grid -mb-6 gap-6 lg:grid-cols-4 md:grid-cols-2 row-gap-5"><article class="transition mb-6"><div class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg mb-6 md:h-64 relative"><a href="/blog/2022/codigo-clave/5"><img alt="CC5: Terminamos Nuestra Aplication Terminal" decoding="async" height="225" loading="lazy" src="http://i3.ytimg.com/vi/5ho0GUaHvuY/hqdefault.jpg" width="400" class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg md:h-full w-full" sizes="(max-width: 900px) 400px, 900px" style="object-fit:cover;object-position:center;max-width:100%;max-height:100%"></a></div><h3 class="mb-2 font-bold font-heading leading-tight sm:text-2xl text-xl"><a href="/blog/2022/codigo-clave/5" class="transition duration-200 ease-in hover:text-primary dark:hover:text-blue-700">CC5: Terminamos Nuestra Aplication Terminal</a></h3><p class="text-muted dark:text-slate-400 text-lg"></p></article><article class="transition mb-6"><div class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg mb-6 md:h-64 relative"><a href="/blog/2022/codigo-clave/6"><img alt="CC6: Primera Aplicación Web con Flask" decoding="async" height="225" loading="lazy" src="http://i3.ytimg.com/vi/51rW7yisBEw/hqdefault.jpg" width="400" class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg md:h-full w-full" sizes="(max-width: 900px) 400px, 900px" style="object-fit:cover;object-position:center;max-width:100%;max-height:100%"></a></div><h3 class="mb-2 font-bold font-heading leading-tight sm:text-2xl text-xl"><a href="/blog/2022/codigo-clave/6" class="transition duration-200 ease-in hover:text-primary dark:hover:text-blue-700">CC6: Primera Aplicación Web con Flask</a></h3><p class="text-muted dark:text-slate-400 text-lg"></p></article><article class="transition mb-6"><div class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg mb-6 md:h-64 relative"><a href="/blog/2023/boom/devlog-9/es"><img alt="5 Lecciones de 4 Reescrituras de mi Aplicación de Idiomas | Boom DevLog 9" decoding="async" height="225" loading="lazy" src="http://i3.ytimg.com/vi/xMP9EiUhOsQ/hqdefault.jpg" width="400" class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg md:h-full w-full" sizes="(max-width: 900px) 400px, 900px" style="object-fit:cover;object-position:center;max-width:100%;max-height:100%"></a></div><h3 class="mb-2 font-bold font-heading leading-tight sm:text-2xl text-xl"><a href="/blog/2023/boom/devlog-9/es" class="transition duration-200 ease-in hover:text-primary dark:hover:text-blue-700">5 Lecciones de 4 Reescrituras de mi Aplicación de Idiomas | Boom DevLog 9</a></h3><p class="text-muted dark:text-slate-400 text-lg"></p></article><article class="transition mb-6"><div class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg mb-6 md:h-64 relative"><a href="/blog/2022/pkos/16"><img alt="OS16: Integration Test with QEMU in CI/CD Using Pytest" decoding="async" height="225" loading="lazy" src="http://i3.ytimg.com/vi/zcqJHKUKipg/hqdefault.jpg" width="400" class="dark:bg-slate-700 bg-gray-400 rounded shadow-lg md:h-full w-full" sizes="(max-width: 900px) 400px, 900px" style="object-fit:cover;object-position:center;max-width:100%;max-height:100%"></a></div><h3 class="mb-2 font-bold font-heading leading-tight sm:text-2xl text-xl"><a href="/blog/2022/pkos/16" class="transition duration-200 ease-in hover:text-primary dark:hover:text-blue-700">OS16: Integration Test with QEMU in CI/CD Using Pytest</a></h3><p class="text-muted dark:text-slate-400 text-lg"></p></article></div></div></section></main><footer class="relative not-prose border-gray-200 border-t dark:border-slate-800"><div class="absolute inset-0 pointer-events-none dark:bg-dark" aria-hidden="true"></div><div class="mx-auto sm:px-6 px-4 dark:text-slate-300 max-w-7xl relative"><div class="grid gap-4 gap-y-8 grid-cols-12 md:py-12 py-8 sm:gap-8"><div class="col-span-12 lg:col-span-4"><div class="mb-2"><a href="/" class="font-bold text-xl inline-block">PageKey</a></div><div class="text-muted text-sm"></div></div><div class="col-span-6 lg:col-span-2 md:col-span-3"><div class="mb-2 font-medium dark:text-gray-300">Products</div><ul class="text-sm"><li class="mb-2"><a href="/products/boom" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">Boom Languages</a></li><li class="mb-2"><a href="/products/keydo" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">KeyDo</a></li><li class="mb-2"><a href="/products/keyreader" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">KeyReader</a></li><li class="mb-2"><a href="/products/pkos" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">PageKey Operating System</a></li><li class="mb-2"><a href="/products/pkvid" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">PKVid</a></li><li class="mb-2"><a href="/products/ptd" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">Plaintext DAW</a></li></ul></div><div class="col-span-6 lg:col-span-2 md:col-span-3"><div class="mb-2 font-medium dark:text-gray-300">Community</div><ul class="text-sm"><li class="mb-2"><a href="https://github.com/pagekey" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">GitHub</a></li><li class="mb-2"><a href="https://discord.gg/5m5yFgDPF5" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">Discord</a></li><li class="mb-2"><a href="https://youtube.com/@PageKey" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">YouTube</a></li></ul></div><div class="col-span-6 lg:col-span-2 md:col-span-3"><div class="mb-2 font-medium dark:text-gray-300">Tags</div><ul class="text-sm"><li class="mb-2"><a href="/blog/tags" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">All Tags</a></li><li class="mb-2"><a href="/tag/python" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">Python</a></li><li class="mb-2"><a href="/tag/rust" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">Rust</a></li></ul></div><div class="col-span-6 lg:col-span-2 md:col-span-3"><div class="mb-2 font-medium dark:text-gray-300">Languages</div><ul class="text-sm"><li class="mb-2"><a href="/blog" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">English</a></li><li class="mb-2"><a href="/tag/spanish" class="text-muted dark:text-gray-400 duration-150 ease-in-out hover:text-gray-700 hover:underline transition">Español</a></li></ul></div></div><div class="md:items-center md:flex md:justify-between md:py-8 py-6"><ul class="flex -ml-2 mb-4 md:mb-0 md:ml-4 md:order-1 rtl:-mr-2 rtl:md:ml-0 rtl:md:mr-4 rtl:ml-0"><li><a href="https://discord.gg/5m5yFgDPF5" class="text-muted dark:text-gray-400 dark:focus:ring-gray-700 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex items-center p-2.5 rounded-lg text-sm" aria-label="Discord"><svg class="h-5 w-5" data-icon="tabler:brand-discord" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-discord"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M8 12a1 1 0 1 0 2 0a1 1 0 0 0-2 0m6 0a1 1 0 1 0 2 0a1 1 0 0 0-2 0"/><path d="M15.5 17c0 1 1.5 3 2 3c1.5 0 2.833-1.667 3.5-3c.667-1.667.5-5.833-1.5-11.5c-1.457-1.015-3-1.34-4.5-1.5l-.972 1.923a11.913 11.913 0 0 0-4.053 0L9 4c-1.5.16-3.043.485-4.5 1.5c-2 5.667-2.167 9.833-1.5 11.5c.667 1.333 2 3 3.5 3c.5 0 2-2 2-3"/><path d="M7 16.5c3.5 1 6.5 1 10 0"/></g></symbol><use xlink:href="#ai:tabler:brand-discord"></use></svg></a></li><li><a href="https://youtube.com/@PageKey" class="text-muted dark:text-gray-400 dark:focus:ring-gray-700 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex items-center p-2.5 rounded-lg text-sm" aria-label="YouTube"><svg class="h-5 w-5" data-icon="tabler:brand-youtube" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-youtube"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M2 8a4 4 0 0 1 4-4h12a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4z"/><path d="m10 9l5 3l-5 3z"/></g></symbol><use xlink:href="#ai:tabler:brand-youtube"></use></svg></a></li><li><a href="https://github.com/pagekey" class="text-muted dark:text-gray-400 dark:focus:ring-gray-700 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex items-center p-2.5 rounded-lg text-sm" aria-label="Github"><svg class="h-5 w-5" data-icon="tabler:brand-github" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-github"><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2c2.8-.3 5.5-1.4 5.5-6a4.6 4.6 0 0 0-1.3-3.2a4.2 4.2 0 0 0-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3 0 0 0-6.2 0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2 0 0 0-.1 3.2A4.6 4.6 0 0 0 4 9.5c0 4.6 2.7 5.7 5.5 6c-.6.6-.6 1.2-.5 2V21" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:brand-github"></use></svg></a></li><li><a href="https://instagram.com/pagekeysolutions" class="text-muted dark:text-gray-400 dark:focus:ring-gray-700 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex items-center p-2.5 rounded-lg text-sm" aria-label="Instagram"><svg class="h-5 w-5" data-icon="tabler:brand-instagram" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:brand-instagram"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M4 8a4 4 0 0 1 4-4h8a4 4 0 0 1 4 4v8a4 4 0 0 1-4 4H8a4 4 0 0 1-4-4z"/><path d="M9 12a3 3 0 1 0 6 0a3 3 0 1 0-6 0m7.5-4.5v.01"/></g></symbol><use xlink:href="#ai:tabler:brand-instagram"></use></svg></a></li><li><a href="/rss.xml" class="text-muted dark:text-gray-400 dark:focus:ring-gray-700 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 hover:bg-gray-100 inline-flex items-center p-2.5 rounded-lg text-sm" aria-label="RSS"><svg class="h-5 w-5" data-icon="tabler:rss" height="1em" viewBox="0 0 24 24" width="1em"><symbol id="ai:tabler:rss"><path d="M4 19a1 1 0 1 0 2 0a1 1 0 1 0-2 0M4 4a16 16 0 0 1 16 16M4 11a9 9 0 0 1 9 9" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/></symbol><use xlink:href="#ai:tabler:rss"></use></svg></a></li></ul><div class="dark:text-muted mr-4 text-sm"><span class="h-5 w-5 bg-[url(/favicon.ico)] bg-cover float-left md:-mt-0.5 md:h-6 md:w-6 mr-1.5 rounded-sm rtl:float-right rtl:ml-1.5 rtl:mr-0"></span> Copyright &copy; 2024 PageKey Solutions, LLC · All rights reserved.</div></div></div></footer><script>!function(){const e="system";if(window.basic_script)return;function t(e){"dark"===e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}window.basic_script=!0;const d=function(){e&&e.endsWith(":only")||(localStorage.theme,0)?t(e.replace(":only","")):"dark"===localStorage.theme||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):t("light")};function a(e,t,d){const a="string"==typeof e?document.querySelectorAll(e):e;a&&a.length&&a.forEach((e=>{e.addEventListener(t,(t=>d(t,e)),!1)}))}d();const o=function(){let t=window.scrollY,d=!0;function o(){const e=document.querySelector("#header[data-aw-sticky-header]");t>60&&!e.classList.contains("scroll")?document.getElementById("header").classList.add("scroll"):t<=60&&e.classList.contains("scroll")&&document.getElementById("header").classList.remove("scroll"),d=!1}a("#header nav","click",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),a("[data-aw-toggle-menu]","click",(function(e,t){t.classList.toggle("expanded"),document.body.classList.toggle("overflow-hidden"),document.getElementById("header")?.classList.toggle("h-screen"),document.getElementById("header")?.classList.toggle("expanded"),document.getElementById("header")?.classList.toggle("bg-page"),document.querySelector("#header nav")?.classList.toggle("hidden"),document.querySelector("#header > div > div:last-child")?.classList.toggle("hidden")})),a("[data-aw-toggle-color-scheme]","click",(function(){e.endsWith(":only")||(document.documentElement.classList.toggle("dark"),localStorage.theme=document.documentElement.classList.contains("dark")?"dark":"light")})),a("[data-aw-social-share]","click",(function(e,t){const d=t.getAttribute("data-aw-social-share"),a=encodeURIComponent(t.getAttribute("data-aw-url")),o=encodeURIComponent(t.getAttribute("data-aw-text"));let n;switch(d){case"facebook":n=`https://www.facebook.com/sharer.php?u=${a}`;break;case"twitter":n=`https://twitter.com/intent/tweet?url=${a}&text=${o}`;break;case"linkedin":n=`https://www.linkedin.com/shareArticle?mini=true&url=${a}&title=${o}`;break;case"whatsapp":n=`https://wa.me/?text=${o}%20${a}`;break;case"mail":n=`mailto:?subject=%22${o}%22&body=${o}%20${a}`;break;default:return}const c=document.createElement("a");c.target="_blank",c.href=n,c.click()})),window.matchMedia("(max-width: 767px)").addEventListener("change",(function(){document.querySelector("[data-aw-toggle-menu]")?.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.getElementById("header")?.classList.remove("bg-page"),document.querySelector("#header nav")?.classList.add("hidden"),document.querySelector("#header > div > div:last-child")?.classList.add("hidden")})),o(),a([document],"scroll",(function(){t=window.scrollY,d||(window.requestAnimationFrame((()=>{o()})),d=!0)}))},n=function(){document.documentElement.classList.add("motion-safe:scroll-smooth");const e=document.querySelector("[data-aw-toggle-menu]");e&&e.classList.remove("expanded"),document.body.classList.remove("overflow-hidden"),document.getElementById("header")?.classList.remove("h-screen"),document.getElementById("header")?.classList.remove("expanded"),document.querySelector("#header nav")?.classList.add("hidden")};window.onload=o,window.onpageshow=n,document.addEventListener("astro:after-swap",(()=>{d(),o(),n()}))}()</script></body></html>