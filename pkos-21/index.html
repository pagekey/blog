
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../boom-devlog-9/">
      
      
        <link rel="next" href="../nextauth/">
      
      
      <link rel="icon" href="../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>OS21: More PCI + Getting Started with Storage (IDE, SATA) - PageKey</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#what-we-did" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PageKey" class="md-header__button md-logo" aria-label="PageKey" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PageKey
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              OS21: More PCI + Getting Started with Storage (IDE, SATA)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/es/" hreflang="es" class="md-select__link">
              Espa√±ol
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PageKey" class="md-nav__button md-logo" aria-label="PageKey" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    PageKey
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="https://pagekey.io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Main Site
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blog
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tags
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../archive/2018/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2018
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../archive/2017/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2017
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/boom-languages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Boom Languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/self-hosting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self-Hosting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/pagekey-operating-system/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PageKey Operating System
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/plaintext-daw/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plaintext DAW
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/rust-book-speedrun/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rust Book Speedrun
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/markdown-sitegen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Markdown Sitegen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/keyreader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    KeyReader
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/first-time-programmer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    First Time Programmer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/what-i-learned-recently/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What I Learned Recently
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/quick-python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quick Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/90-seconds-or-less/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    90 Seconds or Less
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/data-structures-algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Structures & Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../category/linux-kernel-series/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Kernel Series
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-we-did" class="md-nav__link">
    What We Did
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lessons-learned" class="md-nav__link">
    Lessons Learned
  </a>
  
    <nav class="md-nav" aria-label="Lessons Learned">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#structs-are-wonderful" class="md-nav__link">
    Structs are wonderful
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pci-class-and-subclass-identify-device-function" class="md-nav__link">
    PCI Class and Subclass: Identify device function
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rust-bare-metal-i686-support-is-dodgy" class="md-nav__link">
    Rust bare-metal i686 support is dodgy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-drivers-ide-pata-and-ahci-sata-are-very-different" class="md-nav__link">
    Storage Drivers: IDE (PATA) and AHCI (SATA) are very different
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-dives" class="md-nav__link">
    Deep Dives
  </a>
  
    <nav class="md-nav" aria-label="Deep Dives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parsing-pci-fields-into-struct" class="md-nav__link">
    Parsing PCI Fields into Struct
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ignoring-non-existent-pci-devices" class="md-nav__link">
    Ignoring Non-Existent PCI Devices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#looking-up-pci-devices" class="md-nav__link">
    Looking Up PCI Devices
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pci-base-class-subclass-and-programming-interface" class="md-nav__link">
    PCI Base Class, Subclass, and Programming Interface
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attempts-to-use-rust" class="md-nav__link">
    Attempts to use Rust
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-ide" class="md-nav__link">
    What is IDE?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#what-is-sata" class="md-nav__link">
    What is SATA?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-sata-to-qemu" class="md-nav__link">
    Adding SATA to QEMU
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#wrap-up" class="md-nav__link">
    Wrap-Up
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href=".." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://github.com/stephengrice.png" alt="Steve Grice">
                    </span>
                    <span class="md-profile__description">
                      <strong>Steve Grice</strong><br>
                      Techie
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2023-07-10 00:00:00" class="md-ellipsis">July 10, 2023</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../category/pagekey-operating-system/">PageKey Operating System</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              11 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  
  

<nav class="md-tags" >
  
    
    
    
      <a href="../tags/#c" class="md-tag">c</a>
    
  
</nav>



  <h1>OS21: More PCI + Getting Started with Storage (IDE, SATA)</h1>

<div><p>Our entire world runs on computers, but few understand how they work at the lowest level. Everything, from your phone and laptop to the flight controllers on an airliner, has at least one computer chip in it called the CPU, which tells it what to do.</p>
<!-- more -->

<p><div class="video-container"><iframe src="https://www.youtube.com/embed/vNMJbqNZrHI" style="position:relative;width:100%;height:22.172vw" frameborder="0" allowfullscreen alt="type:video"></iframe></div></p>
<p>The operating system is supposed to handle all of the low-level operations, including interfacing with hardware. But what does that interface actually look like? It's easy enough to write a file using <code>file.write()</code> in Python, but this is just an abstraction for what's really happening. Somewhere, under the covers of layers and layers of abstraction, there's a metal disk spinning, or an solid state drive, and you're rearranging zeros and ones on that drive.</p>
<p>In this series, we throw away all of those comfortable abstractions that are provided to us and do bare-metal programming. Our code runs directly on the processor - there's no standard library, there are no system calls, there's no API other than the processor itself. If figuring out how to make things happen with <strong>only</strong> the processor and nothing else sounds exciting to you, then this series is for you.</p>
<p>PKOS stands for PageKey Operating System, which is an operating system built from scratch, on video, with each lesson learned along the way explained so that you can easily understand it and apply it to your own projects.</p>
<p>In this lesson, we continue our exploration of PCI, clean up the codebase a bit, attempt (unsuccessfully) to use Rust, and begin researching how to write a storage device driver.</p>
<h2 id="what-we-did">What We Did</h2>
<p>Here's a quick summary of what was accomplished since the last video. The most important additions will be expanded upon in the Deep Dives section below.</p>
<ul>
<li>Significantly refined <code>pci.c</code><ul>
<li>Added <code>struct PCI_Device</code></li>
</ul>
</li>
<li>Code improvements<ul>
<li>Easier int-to-string calls</li>
<li>Screen wrap</li>
</ul>
</li>
<li>Rust sidequest: unsuccessful</li>
<li>Researched IDE drivers</li>
<li>Researched SATA drivers</li>
<li>Attached SATA device to QEMU</li>
</ul>
<h2 id="lessons-learned">Lessons Learned</h2>
<p>Working through the code for this video yielded a ton of great lessons. Here's what I found:</p>
<h3 id="structs-are-wonderful">Structs are wonderful</h3>
<p>I was dragging my feet on implementing a struct to hold the PCI device data I was grabbing from the configuration memory, but I was amazed at how easy it was to do and how much cleaner the code got when I did. Just look at this lovely little struct:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">PCI_Device</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="n">u16</span><span class="w"> </span><span class="n">vendor_id</span><span class="p">;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="n">u16</span><span class="w"> </span><span class="n">device_id</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">u8</span><span class="w"> </span><span class="n">base_class</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="n">u8</span><span class="w"> </span><span class="n">sub_class</span><span class="p">;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="n">u8</span><span class="w"> </span><span class="n">prog_interface</span><span class="p">;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="n">u16</span><span class="w"> </span><span class="n">command</span><span class="p">;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="n">u16</span><span class="w"> </span><span class="n">status</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="p">};</span>
</span></code></pre></div>
<p>With this in place, I was able to abstract away all of the bitshifting that was required to get this data from the PCI configuration memory and just return the finished object. This made the implementation of <code>lspci()</code> much cleaner and easier to read, and it will avoid duplicating code when we write the storage device driver.</p>
<h3 id="pci-class-and-subclass-identify-device-function">PCI Class and Subclass: Identify device function</h3>
<p>Every PCI device has a Vendor ID and a Device ID, and you can use these two numbers to look up exactly what that device is - just type it in on <a href="https://www.pcilookup.com/">pcilookup.com</a> and see what you come up with!</p>
<h3 id="rust-bare-metal-i686-support-is-dodgy">Rust bare-metal i686 support is dodgy</h3>
<p>I was sad to find that 32-bit x86, also known is i386 or i686, does not have the best support in Rust for bare-metal programming. There is no default <code>i686-unknown-none</code> toolchain, which means that you have to define your own based off of the <code>i686-unknown-linux-gnu</code>. I tried my best, but couldn't seem to get a multiboot kernel to compile.</p>
<p>I'd love to use Rust if I could figure it out, but it wasn't in the cards for this episode - we'll stick to the simplicity of C for now.</p>
<h3 id="storage-drivers-ide-pata-and-ahci-sata-are-very-different">Storage Drivers: IDE (PATA) and AHCI (SATA) are very different</h3>
<p>I spent a fair amount of time trying to get the IDE controller that was attached to QEMU by default working. I'm not sure if it's actually what I need - it seemed to be a cdrom drive.</p>
<p>From what I gathered, IDE/PATA is no longer used for hard drives, but may still be used for CDs. SATA/AHCI, on the other hand, are still very much relevant. See the deep dives below for more information on these technologies.</p>
<h2 id="deep-dives">Deep Dives</h2>
<p>Let's dive into the details of the code for this episode.</p>
<h3 id="parsing-pci-fields-into-struct">Parsing PCI Fields into Struct</h3>
<p>The PCI configuration memory layout was essential in figuring out how to parse the fields:</p>
<p><img alt="PCI Configuration Memory" src="../2023/pkos-21/PCI_Configuration_Space.png"></p>
<p>Recall that we have a working <code>read_pci_port</code> function at our disposal, and it takes four single-byte arguments: <code>bus</code>, <code>slot</code>, <code>function</code>, and <code>offset</code>. For a given PCI device, we can make multiple calls to this function, changing the <code>offset</code> field to grab the variables we want out of the structure above. For example, here's a snippet of how we get the vendor and device ID:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">PCI_Device</span><span class="w"> </span><span class="n">device</span><span class="p">;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">u32</span><span class="w"> </span><span class="n">pci_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_pci_port</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span><span class="w"> </span><span class="n">slot</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">device</span><span class="p">.</span><span class="n">vendor_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pci_data</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xffff</span><span class="p">;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="n">device</span><span class="p">.</span><span class="n">device_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pci_data</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xffff</span><span class="p">;</span>
</span></code></pre></div>
<p>As you can see, we grab 32-bits at offset 0, then bitshift/AND the result until we isolate the fields that we need.</p>
<p>Check out this early look at the lspci method:</p>
<p><img alt="LSPCI Early Output" src="../2023/pkos-21/lspci_output_early.png"></p>
<p>It looks great! The only problem is that there are quite a few devices with Vendor ID "pppp." That can't be right - so what's going on here? Well...</p>
<h3 id="ignoring-non-existent-pci-devices">Ignoring Non-Existent PCI Devices</h3>
<p>The Linux kernel finds non-existent PCI devices by checking if the PCI class field is set to <code>0xFFFFFFFF</code> [1]. OSDev mentions that you can also check whether the Vendor ID field is set to <code>0xFFFF</code> [2]. Though both probably work, I went with the latter technique. Applying this knowledge will save our <code>lspci()</code> function some work by skipping any further processing when it detects a nonexistent device:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">PCI_Device</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_pci_device</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">);</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">device</span><span class="p">.</span><span class="n">vendor_id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFFFF</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>Now we only see a few devices, and none of them have invalid fields for Vendor ID anymore!</p>
<p><img alt="lspci_output.png" src="../2023/pkos-21/lspci_output.png"></p>
<h3 id="looking-up-pci-devices">Looking Up PCI Devices</h3>
<p>Looking at the above screenshot, how much can you tell about the devices listed? At first, I had no clue where to start with deciphering these fields. However, a quick search showed me that I can use <a href="https://www.pcilookup.com/">pcilookup.com</a> to find out what each of these devices are. For example, looking up Vendor ID 8086 and Device 7010 yields:</p>
<p><img alt="pcilookup.png" src="../2023/pkos-21/pcilookup.png"></p>
<p>This matches up with the QEMU documentation, and with the output of <code>info qtree</code>, so it seems like our <code>lspci()</code> method is accurate.</p>
<h3 id="pci-base-class-subclass-and-programming-interface">PCI Base Class, Subclass, and Programming Interface</h3>
<p>The PCI fields list above shows one big 3-byte chunk for "Class Code," but documentation sometimes referred to the "subclass" field, which I couldn't seem to find anywhere. However, it did seem to be a powerful way to tell what type of device you were dealing with - as an example, class 1 indicates a mass storage device, and class 1 subclass 1 indicates an IDE interface [3].</p>
<p>The specification documents for PCI don't seem to be freely available online - you have to login to PCI-SIG's website to download any of them. However, someone hosted the "PCI Local Bus Specification" from 2004 on their website [4], so I was able to take a look. On page 217, we see:</p>
<blockquote>
<p>The Class Code register is read-only and is used to identify the generic function of the device and, in some cases, a specific registerlevel programming interface. The register is broken into three bytesize fields. The upper byte (at offset 0Bh) is a base class code which broadly classifies the type of function the device performs. The middle byte (at offset 0Ah) is a sub-class code which identifies more specifically the function of the device. The lower byte (at offset 09h) identifies a specific register-level programming interface (if any) so that device independent software can interact with the device. Encodings for base class, sub-class, and programming interface are provided in Appendix D. All unspecified encodings are reserved.</p>
</blockquote>
<p>So, this just means that the three bytes allocated for "Class Code" are one byte each, representing base class at <code>0x0b</code>, subclass at <code>0x0a</code>, and programming interface at <code>0x09</code>. Simple enough! We can parse those fields with this snippet:</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">pci_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">read_pci_port</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span><span class="w"> </span><span class="n">slot</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">,</span><span class="w"> </span><span class="mh">0x09</span><span class="p">);</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="n">device</span><span class="p">.</span><span class="n">base_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pci_data</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff</span><span class="p">;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">device</span><span class="p">.</span><span class="n">sub_class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">pci_data</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="n">device</span><span class="p">.</span><span class="n">prog_interface</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pci_data</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0xff</span><span class="p">;</span>
</span></code></pre></div>
<p>I cheated a little bit by reading with offset <code>0x09</code> to save some bitshifting. I'm not sure if there is some kind of performance impact for not reading at 4-byte boundaries. There probably is, but for our purposes, does it really matter?</p>
<h3 id="attempts-to-use-rust">Attempts to use Rust</h3>
<p>I attempted to create a multiboot i386 kernel using Rust. If I had been successful, I could have linked in all of the existing C and assembly code into that executable, and any new development could have been in Rust! Unfortunately, I hit some roadblocks.</p>
<p>A StackOverflow answer by phip1611 [5] informed me that while there's no built-in target for bare-metal 32-bit x86 code, you can define a custom target by putting a JSON file at the root of the project and pointing to it in <code>.cargo/config.toml</code>. Using the <code>#![no_std]</code> and <code>#![no_main]</code> macros turn off the standard library and main method, which enable bare-metal execution.</p>
<p>I also found an awesome tutorial called "Writing an OS in Rust" [6] which explained each piece of the puzzle very clearly. However, the whole tutorial was written for x86_64. Maybe the time to upgrade PKOS is coming, but I'm not ready to let go of 32-bit yet.</p>
<p>After messing with <code>xargo</code> for cross compiling for quite a while, I finally gave up on this path - for now.</p>
<h3 id="what-is-ide">What is IDE?</h3>
<p>IDE stands for Integrated Drive Electronics. It's an electrical standard for disk storage devices released in 1990. It was originally referred to as Advanced Technology Attachment (ATA), but after the introduction of Serial ATA (SATA), it was renamed to Parallel ATA (PATA) [7].</p>
<p>We can identify IDE devices using the Class Code field in the PCI configuration space. OSDev wiki [8] tells us:</p>
<blockquote>
<p>If the class code is 0x01 (Mass Storage Controller) and the subclass code is 0x01 (IDE), the device is an IDE controller.</p>
</blockquote>
<p>This takes care of the first two fields, but what about that pesky Programming Interface byte? I found something that says it's used to indicate whether the primary and secondary storage devices are programmable, as well as their operating mode [9].</p>
<p><img alt="ide_class_code.png" src="../2023/pkos-21/ide_class_code.png"></p>
<figcaption>Photo credits: [9]</figcaption>

<p>I was able to find the specification for a PCI IDE card online, and I particularly enjoyed seeing that the class codes matched up with what I had seen so far from other sources:</p>
<p><img alt="example_pci_card_spec_snippet.png" src="../2023/pkos-21/example_pci_card_spec_snippet.png"></p>
<figcaption>Photo credits: [11]</figcaption>

<p>Another potentially helpful resource was a guide for writing an IDE driver from the RTEMS real time operating system's documentation [12]. I was also able to find the source code on GitHub [13]. It seems like the ATA driver in <code>ata.c</code> uses the (perhaps) lower-level functions in <code>ide_controller.c</code>, but I'm not quite sure.</p>
<p>RTEMS provides a separate guide for writing an ATA driver [16]. OSDev has one too [17]. This is confusing, because the TechTarget article [7] seems to indicate that ATA and IDE are basically interchangeable.</p>
<h3 id="what-is-sata">What is SATA?</h3>
<p>SATA stands for Serial Advanced Technology Attachment, defined, as noted above, in contrast to IDE/PATA. AHCI stands for Advanced Host Controller Interface. I've seen these two acronyms used interchangeably in some of the drivers I saw online. However, Dell indicates that it may be more complicated to support an AHCI device than a SATA device [11]. </p>
<p><img alt="pata_vs_sata.png" src="../2023/pkos-21/pata_vs_sata.png"></p>
<figcaption>Photo credits: TechTarget [7]</figcaption>

<h3 id="adding-sata-to-qemu">Adding SATA to QEMU</h3>
<p>A Stack Overflow answer by mwfearnley [14] notes how to explicitly add a SATA device to QEMU:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>-drive id=disk,file=IMAGE.img,if=none \
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>-device ahci,id=ahci \
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>-device ide-hd,drive=disk,bus=ahci.0
</span></code></pre></div>
<p>I appended these lines to the <code>os.py</code> script's <code>run</code> and <code>run_debug</code> methods and, lo and behold, the SATA drive appeared in <code>lspci</code>! It's on Bus 0, Device 4, Function 0 in the image below:</p>
<p><img alt="lspci_output.png" src="../2023/pkos-21/lspci_output.png"></p>
<p>Ruben Schade highlighted a similar technique for adding the drive in his blog [15]. It also seems like it may have been enough to simply add <code>-hda IMAGE.img</code> to the QEMU run command, but since I did it the complicated way first and it worked, I just stuck with it. </p>
<h2 id="wrap-up">Wrap-Up</h2>
<p>Even though I didn't quite get as far as I'd hoped in this episode, I still made some progress and learned a lot. I hope you enjoyed it and learned something too!</p>
<p>Next steps for this project will likely be trying to get some sort of SATA driver working, though from what I've seen so far, I'm a little intimidated by how complex it can get. We'll see where things go!</p>
<p>If you enjoyed this post, consider subscribing to the <a href="https://youtube.com/@PageKey">PageKey YouTube channel</a>.</p>
<h2 id="references">References</h2>
<p>[1]: Linux kernel "early_dump_pci_devices" method checking whether the device exists using the class field. <a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/pci/early.c?id=refs/tags/v3.12.7#n96">https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/pci/early.c?id=refs/tags/v3.12.7#n96</a></p>
<p>[2]: OSDev PCI page. <a href="https://wiki.osdev.org/PCI">https://wiki.osdev.org/PCI</a></p>
<p>[3]: Site showing the PCI device classes and subclasses. <a href="https://pci-ids.ucw.cz/read/PD/">https://pci-ids.ucw.cz/read/PD/</a></p>
<p>[4]: PCI Local Bus Specification from 2004. <a href="https://lekensteyn.nl/files/docs/PCI_SPEV_V3_0.pdf">https://lekensteyn.nl/files/docs/PCI_SPEV_V3_0.pdf</a></p>
<p>[5]: Bare-metal x86 Rust target, thanks phip1611. <a href="https://stackoverflow.com/questions/67902309/how-to-compile-rust-code-to-bare-metal-32-bit-x86-i686-code-what-compile-targ">https://stackoverflow.com/questions/67902309/how-to-compile-rust-code-to-bare-metal-32-bit-x86-i686-code-what-compile-targ</a></p>
<p>[6]: Writing an OS in Rust: <a href="https://os.phil-opp.com/freestanding-rust-binary/">https://os.phil-opp.com/freestanding-rust-binary/</a></p>
<p>[7]: TechTarget high level description of PATA and SATA interfaces. <a href="https://www.techtarget.com/searchstorage/definition/IDE">https://www.techtarget.com/searchstorage/definition/IDE</a></p>
<p>[8]: OSDev PCI IDE Controller article. <a href="https://wiki.osdev.org/PCI_IDE_Controller">https://wiki.osdev.org/PCI_IDE_Controller</a></p>
<p>[9]: PCI IDE Controller Specification. <a href="http://www.isdaman.com/alsos/hardware/hdc/pciide.pdf">http://www.isdaman.com/alsos/hardware/hdc/pciide.pdf</a></p>
<p>[10]: Example of a PCI IDE controller card vendor specification. <a href="https://pdf.dzsc.com/PC8/PC87410.pdf">https://pdf.dzsc.com/PC8/PC87410.pdf</a></p>
<p>[11]: Dell article on SATA vs AHCI. <a href="https://www.dell.com/support/kbdoc/en-us/000127508/difference-between-ahci-and-sata">https://www.dell.com/support/kbdoc/en-us/000127508/difference-between-ahci-and-sata</a></p>
<p>[12]: RTEMS guide for PCI IDE drivers. <a href="https://docs.rtems.org/branches/master/bsp-howto/ide_controller.html">https://docs.rtems.org/branches/master/bsp-howto/ide_controller.html</a></p>
<p>[13]: RTEMS PCI IDE driver reference implementation. <a href="https://github.com/RTEMS/rtems/tree/master/bsps/shared/dev/ide">https://github.com/RTEMS/rtems/tree/master/bsps/shared/dev/ide</a></p>
<p>[14]: Stack Overflow on adding a SATA drive to QEMU. <a href="https://stackoverflow.com/questions/48351096/how-to-emulate-a-sata-disk-drive-in-qemu">https://stackoverflow.com/questions/48351096/how-to-emulate-a-sata-disk-drive-in-qemu</a></p>
<p>[15]: Ruben Schade on adding a SATA drive to QEMU. <a href="https://rubenerd.com/sata-on-qemu/">https://rubenerd.com/sata-on-qemu/</a></p>
<p>[16]: RTEMS ATA driver guide. <a href="https://docs.rtems.org/branches/master/bsp-howto/ata.html">https://docs.rtems.org/branches/master/bsp-howto/ata.html</a></p>
<p>[17]: OSDev ATA driver. <a href="https://github.com/levex/osdev/blob/master/drivers/ata.c">https://github.com/levex/osdev/blob/master/drivers/ata.c</a></p></div>



  



      
    </article>
  </div>

          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2017 - <script>document.write(new Date().getFullYear())</script> PageKey Solutions, LLC
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/@PageKey" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "content.code.copy"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>